<div class="row">
    <div class="col-md-12">

        <div class="row row-gap-3">
            <div class="col-md-12">

                <div class="form-group row" id="AllTeachersContainer">
                    <label class="">Student's Teachers</label>
                    <select class="js-example-basic-multiple select2 form-control"
                            required
                            id="AllTeachers"
                            asp-items="@ViewBag.DdlTeachers" style="width: 100%;" style="width: 100%; color:black;"
                            multiple="multiple">
                    </select>
                    <span id="TeachersIdsSpanValidation" class="text-danger"></span>
                </div>

            </div>

            <div class="col-md-12">
                <div class="form-group row">
                    <input type="file" id="UploadfileInput" class="btn btn-primary w-fit mx-auto">
                </div>
            </div>

            <div class="form-group row">
                <div class="col-sm-12">
                    <button type="button" id="btnSave" onclick="UploadFile()" class="btn btn-success">
                        Upload
                    </button>
                    <button type="button" id="btnClose" class="btn btn-danger" data-bs-dismiss="modal">
                        Close
                    </button>
                </div>
            </div>

        </div>
    </div>
</div>

<style>
    .select2-container--default .select2-selection--multiple .select2-selection__choice {
        color: black;
    }
</style>

<script src="/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.js"></script>

<script>
    $(document).ready(function () {
        InitialPartialSelect2($("#AllTeachersContainer"));
    });

    var UploadFile =function() {
        debugger
        $("#btnSave").html("Uploading...");
        $('#btnSave').attr('disabled', 'disabled');

        var fileInput = document.getElementById('UploadfileInput');
        var file = fileInput.files[0];

        var formData = new FormData();

        var optionsVal = [];
        // $("#AllTeachers option:selected").each(function () {
        //     optionsVal.push({Id:$(this).val()});
        // });
        $("#AllTeachers option:selected").each(function () {
            formData.append('TeachersIds', $(this).val());
        });
        var TeachersIdsJson = JSON.stringify(optionsVal);
        formData.append('ExcelFileInfo', file);
        // formData.append('TeachersIds', TeachersIdsJson);

        $.ajax({
            url: "/Excel/UploadStudentsData",
            type: 'POST',
            data: formData,
            processData: false,
            contentType: false,
            success: function (response) {
                debugger
                if (response.IsSuccess) {
                    Swal.fire({
                        title: response.AlertMessage,
                        icon: 'success',
                        didClose: () => {
                            document.getElementById("UploadfileInput").value = "";
                            $('#tblStudents').DataTable().ajax.reload();
                            document.getElementById("btnClose").click();
                            $("#btnSave").html("Upload");
                            $('#btnSave').removeAttr('disabled');
                        }
                    });
                }
                else {
                    Swal.fire({
                        title: response.AlertMessage,
                        icon: 'warning',
                        didClose: () => {
                            document.getElementById("UploadfileInput").value = "";
                            $('#tblStudents').DataTable().ajax.reload();
                            // document.getElementById("btnClose").click();
                            $("#btnSave").html("Upload");
                            $('#btnSave').removeAttr('disabled');
                        }
                    });
                }
            },
            error: function (errormessage) {
                $("#btnSave").html("Upload");
                $('#btnSave').removeAttr('disabled');
                SwalSimpleAlert(errormessage.responseText, "warning");
            }
        });
    }

</script>